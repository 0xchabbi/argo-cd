
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.7">
    
    
      
        <title>Config-Management-Plugin-Enhancement - Argo CD - Declarative GitOps CD for Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font-family:"Work Sans";--md-code-font-family:""}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/versions.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-105170809-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#config-management-plugin-enhancement" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Argo CD - Declarative GitOps CD for Kubernetes" class="md-header__button md-logo" aria-label="Argo CD - Declarative GitOps CD for Kubernetes" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Argo CD - Declarative GitOps CD for Kubernetes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Config-Management-Plugin-Enhancement
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/argoproj/argo-cd/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Argo CD - Declarative GitOps CD for Kubernetes" class="md-nav__button md-logo" aria-label="Argo CD - Declarative GitOps CD for Kubernetes" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Argo CD - Declarative GitOps CD for Kubernetes
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/argoproj/argo-cd/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../understand_the_basics/" class="md-nav__link">
        Understand The Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../core_concepts/" class="md-nav__link">
        Core Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Operator Manual
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Operator Manual" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Operator Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/architecture/" class="md-nav__link">
        Architectural Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/declarative-setup/" class="md-nav__link">
        Declarative Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/ingress/" class="md-nav__link">
        Ingress Configuration
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_5" type="checkbox" id="__nav_5_5" >
      
      <label class="md-nav__link" for="__nav_5_5">
        User Management
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User Management" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          User Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/auth0/" class="md-nav__link">
        Auth0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/microsoft/" class="md-nav__link">
        Microsoft
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/okta/" class="md-nav__link">
        Okta
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/onelogin/" class="md-nav__link">
        OneLogin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/keycloak/" class="md-nav__link">
        Keycloak
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/openunison/" class="md-nav__link">
        OpenUnison
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/user-management/google/" class="md-nav__link">
        Google
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/rbac/" class="md-nav__link">
        RBAC Configuration
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/tls/" class="md-nav__link">
        TLS configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/cluster-bootstrapping/" class="md-nav__link">
        Cluster Bootstrapping
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/secret-management/" class="md-nav__link">
        Secret Management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/high_availability/" class="md-nav__link">
        High Availability
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/disaster_recovery/" class="md-nav__link">
        Disaster Recovery
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/webhook/" class="md-nav__link">
        Git Webhook Configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/health/" class="md-nav__link">
        Resource Health
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/resource_actions/" class="md-nav__link">
        Resource Actions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/custom_tools/" class="md-nav__link">
        Custom Tooling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/custom-styles/" class="md-nav__link">
        Custom Styles
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/notifications/" class="md-nav__link">
        Notifications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/troubleshooting/" class="md-nav__link">
        Troubleshooting Tools
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_20" type="checkbox" id="__nav_5_20" >
      
      <label class="md-nav__link" for="__nav_5_20">
        Server Configuration Parameters
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Server Configuration Parameters" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_20">
          <span class="md-nav__icon md-icon"></span>
          Server Configuration Parameters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/server-commands/argocd-server/" class="md-nav__link">
        Argocd server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/server-commands/argocd-application-controller/" class="md-nav__link">
        Argocd application controller
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/server-commands/argocd-repo-server/" class="md-nav__link">
        Argocd repo server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/server-commands/argocd-dex/" class="md-nav__link">
        Argocd dex
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/server-commands/argocd-util/" class="md-nav__link">
        argocd-util Tools
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_22" type="checkbox" id="__nav_5_22" >
      
      <label class="md-nav__link" for="__nav_5_22">
        Upgrading
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Upgrading" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_22">
          <span class="md-nav__icon md-icon"></span>
          Upgrading
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/2.0-2.1/" class="md-nav__link">
        v2.0 to 2.1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.8-2.0/" class="md-nav__link">
        v1.8 to v2.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.7-1.8/" class="md-nav__link">
        v1.7 to 1.8
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.6-1.7/" class="md-nav__link">
        v1.6 to 1.7
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.5-1.6/" class="md-nav__link">
        v1.5 to 1.6
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.4-1.5/" class="md-nav__link">
        v1.4 to 1.5
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.3-1.4/" class="md-nav__link">
        v1.3 to 1.4
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.2-1.3/" class="md-nav__link">
        v1.2 to 1.3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.1-1.2/" class="md-nav__link">
        v1.1 to 1.2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-manual/upgrading/1.0-1.1/" class="md-nav__link">
        v1.0 to 1.1
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        User Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/application_sources/" class="md-nav__link">
        Tools
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/kustomize/" class="md-nav__link">
        Kustomize
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/helm/" class="md-nav__link">
        Helm
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/ksonnet/" class="md-nav__link">
        Ksonnet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/jsonnet/" class="md-nav__link">
        Jsonnet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/config-management-plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/tool_detection/" class="md-nav__link">
        Tool Detection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/projects/" class="md-nav__link">
        Projects
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/private-repositories/" class="md-nav__link">
        Private Repositories
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/gpg-verification/" class="md-nav__link">
        GnuPG verification
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/auto_sync/" class="md-nav__link">
        Automated Sync Policy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/diffing/" class="md-nav__link">
        Diffing Customization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/orphaned-resources/" class="md-nav__link">
        Orphaned Resources Monitoring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/compare-options/" class="md-nav__link">
        Compare Options
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/sync-options/" class="md-nav__link">
        Sync Options
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/parameters/" class="md-nav__link">
        Parameter Overrides
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/build-environment/" class="md-nav__link">
        Build Environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/tracking_strategies/" class="md-nav__link">
        Tracking and Deployment Strategies
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/resource_hooks/" class="md-nav__link">
        Resource Hooks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/selective_sync/" class="md-nav__link">
        Selective Sync
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/sync-waves/" class="md-nav__link">
        Sync Phases and Waves
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/sync_windows/" class="md-nav__link">
        Sync Windows
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/application-set/" class="md-nav__link">
        Generating Applications with ApplicationSet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/ci_automation/" class="md-nav__link">
        Automation from CI Pipelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/app_deletion/" class="md-nav__link">
        App Deletion
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/best_practices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/status-badge/" class="md-nav__link">
        Status Badge
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/external-url/" class="md-nav__link">
        Add external URL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/commands/argocd/" class="md-nav__link">
        Command Reference
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Developer Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/contributing/" class="md-nav__link">
        Contribution guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/running-locally/" class="md-nav__link">
        Running ArgoCD locally
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/debugging-remote-environment/" class="md-nav__link">
        Debugging a Remote ArgoCD Environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/use-gitpod/" class="md-nav__link">
        Use Gitpod
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/api-docs/" class="md-nav__link">
        API Docs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/test-e2e/" class="md-nav__link">
        E2E Tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/dependencies/" class="md-nav__link">
        Managing Dependencies
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/ci/" class="md-nav__link">
        Continuous Integration (CI)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/releasing/" class="md-nav__link">
        Releasing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/site/" class="md-nav__link">
        Site
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/static-code-analysis/" class="md-nav__link">
        Static Code Analysis
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/faq/" class="md-nav__link">
        Contribution FAQ
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../security_considerations/" class="md-nav__link">
        Security Considerations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../SUPPORT/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/argoproj/argo-cd/releases" class="md-nav__link">
        Releases ⧉
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://blog.argoproj.io/" class="md-nav__link">
        Blog ⧉
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
    <nav class="md-nav" aria-label="Motivation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#goals" class="md-nav__link">
    Goals
  </a>
  
    <nav class="md-nav" aria-label="Goals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#improve-installation-experience" class="md-nav__link">
    Improve Installation Experience
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provide-discovery-auto-selection-of-tool" class="md-nav__link">
    Provide Discovery (Auto-selection of Tool)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters-support-in-uicli" class="md-nav__link">
    Parameters support in UI/CLI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-goals" class="md-nav__link">
    Non-Goals
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposal" class="md-nav__link">
    Proposal
  </a>
  
    <nav class="md-nav" aria-label="Proposal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    Use cases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    Implementation Details
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config-management-plugin-api-server-cmp-server" class="md-nav__link">
    Config Management Plugin API Server (cmp-server)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-communication" class="md-nav__link">
    Registration &amp; Communication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery-auto-selection-of-tool" class="md-nav__link">
    Discovery (Auto-selection of Tool)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    Versioning
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    Security Considerations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risks-and-mitigations" class="md-nav__link">
    Risks and Mitigations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-downgrade-strategy" class="md-nav__link">
    Upgrade / Downgrade Strategy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drawbacks" class="md-nav__link">
    Drawbacks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives" class="md-nav__link">
    Alternatives
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/argoproj/argo-cd/edit/master/docs/proposals/config-management-plugin-v2.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="config-management-plugin-enhancement">Config Management Plugin Enhancement<a class="headerlink" href="#config-management-plugin-enhancement" title="Permanent link">&para;</a></h1>
<p>We want to enhance config management plugin in order to improve Argo CD operator and end-user experience 
for using additional tools such as cdk8s, Tanka, jkcfg, QBEC, Dhall, pulumi, etc. </p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Currently, Argo CD provides first-class support for Helm, Kustomize, Jsonnet/YAML, and Ksonnet. The support includes:
- Bundled binaries (maintainers periodically upgrade binaries)
- An ability to override parameters using UI/CLI
- The applications are discovered in Git repository and auto-suggested during application creation in UI
- Performance optimizations. Argo CD "knows" when it is safe to generate manifests concurrently and takes advantage of it.</p>
<p>We want to enhance the configuration management plugin so that it can provide similar first-class support for additional 
tools such as cdk8s, Tanka, jkcfg, QBEC, Dhall, pulumi, etc.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>The config management plugin feature should be improved to provide the same level of user experience as 
for the natively supported tools to the additional tools such as  cdk8s, Tanka, jkcfg, QBEC, Dhall, pulumi, etc., 
including Argo CD operators as well as end-user experience.</p>
<h3 id="goals">Goals<a class="headerlink" href="#goals" title="Permanent link">&para;</a></h3>
<p>The goals for config management plugin enhancement are,</p>
<h4 id="improve-installation-experience">Improve Installation Experience<a class="headerlink" href="#improve-installation-experience" title="Permanent link">&para;</a></h4>
<p>The current Config Management plugin installation experience requires two changes:
- An entry in configManagementPlugins in the Argo CD configmap (i.e.  argocd-cm)
- Either an init container with a volume mount that adds a new binary into Argo CD repo server pod, or a rebuild of the argocd image, which contains the necessary tooling</p>
<p>The problem with this approach is that the process is error-prone, manual, and requires learning from each and every Argo CD administrator. </p>
<p>The goal is to make additional tools easily accessible for installation to Argo CD operators.</p>
<h4 id="provide-discovery-auto-selection-of-tool">Provide Discovery (Auto-selection of Tool)<a class="headerlink" href="#provide-discovery-auto-selection-of-tool" title="Permanent link">&para;</a></h4>
<p>For Argo CD’s natively supported config management plugins (Helm, Kustomize, Ksonnet, Jsonnet), Argo CD auto-detects 
and selects the appropriate tool given only the path in the Git repository. 
This selection is based on the recognition of well-known files in the directory (e.g. Chart.yaml, kustomization.yaml, etc...). </p>
<p>Currently, unlike natively supported tools, when a plugin is used, a user needs to explicitly specify the plugin 
that should be used to render the manifests. As part of the improvements to config management plugins, </p>
<p>We want to provide the same ability to auto-select the plugin based on recognized files in the path of the git repository.</p>
<h4 id="parameters-support-in-uicli">Parameters support in UI/CLI<a class="headerlink" href="#parameters-support-in-uicli" title="Permanent link">&para;</a></h4>
<p>Currently, configuration management plugins allow specifying only a list of environment variables via UI/CLI. </p>
<p>We want to extend its functionality to provide a similar experience as for existing natively supported tools 
to additional config management tools. </p>
<h3 id="non-goals">Non-Goals<a class="headerlink" href="#non-goals" title="Permanent link">&para;</a></h3>
<ul>
<li>We aren't planning on changing the existing support for native plugins as of now. </li>
</ul>
<h2 id="proposal">Proposal<a class="headerlink" href="#proposal" title="Permanent link">&para;</a></h2>
<p>We have drafted the solution to the problem statement as <strong>running configuration management plugin tools as sidecar in the argocd-repo-server</strong>. </p>
<p>All it means that Argo CD Config Management Plugin 2.0 will be,
- A user-supplied container image with all the necessary tooling installed in it. 
- It will run as a sidecar in the repo server deployment and will have shared access to the git repositories.
- It will contain a CMP YAML specification file describing how to render manifests.
- Its entrypoint will be a lightweight CMP API server that receives requests by the main repo-server to render manifests, 
based on the CMP specification file.</p>
<p>This mechanism will provide the following benefits over the existing solution,
- Plugin owners control their execution environment, packaging whatever dependent binaries required.
- An  Argo CD user who wants to use additional config management tools does not have to go through the hassle of building 
a customized argocd-repo-server in order to install required dependencies. 
- The plugin image will be running in a container separate from the main repo-server.</p>
<h3 id="use-cases">Use cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h3>
<ul>
<li>UC1: As an Argo CD user, I would like to use first-class support provided for additional tools to generate and manage deployable kubernetes manifests</li>
<li>UC2: As an Argo CD operator, I want to have smooth experience while installing additional tools such as  cdk8s, Tanka, jkcfg, QBEC, Dhall, pulumi, etc.</li>
<li>UC3: As a plugin owner, I want to have some control over the execution environment as I want to package whatever dependent binaries required. </li>
</ul>
<h3 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h3>
<p>Config Management Plugin v2.0 implementation and experience will be as,</p>
<h4 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h4>
<p>To install a plugin, an operator will simply patch argocd-repo-server to run config management plugin container as a sidecar, 
with argocd-cmp-server as it’s entrypoint. Operator can use either off-the-shelf or custom built plugin image as sidecar image. </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># A plugin is a container image which runs as a sidecar, with the execution environment</span>
<span class="c1"># necessary to render manifests. To install a plugin, </span>
containers:
- name: cdk8s
  command: <span class="o">[</span>/var/run/argocd/argocd-cmp-server<span class="o">]</span>
  image: docker.ui/cdk8s/cdk8s:latest
  volumeMounts:
  - mountPath: /var/run/argocd
    name: var-files
</code></pre></div>

<p>The argocd-cmp-server binary will be populated inside the plugin container via an init container in the argocd-repo-server, 
which will pre-populate a volume shared between plugins and the repo-server.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># An init container will copy the argocd static binary into the shared volume</span>
<span class="c1"># so that the CMP server can become the entrypoint</span>
initContainers:
- command:
  - cp
  - -n
  - /usr/local/bin/argocd
  - /var/run/argocd/argocd-cmp-server
  image: quay.io/argoproj/argocd:latest
  name: copyutil
  volumeMounts:
  - mountPath: /var/run/argocd
    name: var-files

<span class="c1"># var-files is a shared volume between repo-server and cmp-server which holds:</span>
<span class="c1"># 1) socket files that repo-server uses to communicate to each plugin</span>
<span class="c1"># 2) git repositories cloned by repo-server</span>
volumes:
- emptyDir: <span class="o">{}</span>
  name: var-files
</code></pre></div>

<h4 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h4>
<p>Plugins will be configured via a ConfigManagementPlugin manifest located inside the plugin container, placed at a 
well-known location (e.g. /home/argocd/plugins/plugin.yaml). Argo CD is agnostic to the mechanism of how the plugin.yaml would be placed, 
but various options can be used on how to place this file, including: 
- Baking the file into the plugin image as part of docker build
- Volume mapping the file through a configmap.</p>
<p>Note that, while the ConfigManagementPlugin looks like a Kubernetes object, it is not actually a custom resource. 
It only follows kubernetes-style spec conventions.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># metadata file is in the root and shell executor knows about it</span>
apiVersion: argoproj.io/v1alpha1
kind: ConfigManagementPlugin
metadata:
  name: cdk8s
spec:
  version: v1.0
  init:
    command: <span class="o">[</span>cdk8s, init<span class="o">]</span>
  generate:
    command: <span class="o">[</span>sh, -c, <span class="s2">&quot;cdk8s synth &amp;&amp; cat dist/*.yaml&quot;</span><span class="o">]</span>
  discovery:
    find:
    - command: <span class="o">[</span>find . -name main.ts<span class="o">]</span>
      glob: <span class="s2">&quot;**/*/main.ts&quot;</span>
    check:
    - command: <span class="o">[</span>-f ./main.ts<span class="o">]</span>
      glob: <span class="s2">&quot;main.ts&quot;</span>
  allowConcurrency: <span class="nb">true</span> <span class="c1"># enables generating multiple manifests in parallel. </span>
</code></pre></div>

<h4 id="config-management-plugin-api-server-cmp-server">Config Management Plugin API Server (cmp-server)<a class="headerlink" href="#config-management-plugin-api-server-cmp-server" title="Permanent link">&para;</a></h4>
<p>The Config Management Plugin API Server (cmp-server) will be a new Argo CD component whose sole responsibility will be 
to execute <code>generate</code> commands inside the plugin environment (the sidecar container), at the request of the repo-server.</p>
<p>The cmp-server will expose the following APIs to the repo-server,</p>
<ul>
<li>GenerateManifests(path) - returns YAML output using plugin tooling</li>
<li>IsSupported(path) - returns whether or not the given path is supported by the plugin</li>
</ul>
<p>At startup, cmp-server looks at the /home/argocd/cmp-server/plugin.yaml ConfigManagementPlugin specification file to understand how to perform the requests.</p>
<h4 id="registration-communication">Registration &amp; Communication<a class="headerlink" href="#registration-communication" title="Permanent link">&para;</a></h4>
<p>The repo-server needs to understand what all plugins are available to render manifests. To do this, the cmp-server 
sidecars will register themselves as available plugins to the argocd-repo-server by populating named socket files in the 
shared volume between repo-server and cmp-server. e.g.:</p>
<div class="codehilite"><pre><span></span><code>/home/argocd/plugins/
                        cdk8s.sock
                        jkcfg.sock
                        pulumi.sock
</code></pre></div>

<p>The name of the socket file will indicate the plugin name. To discover the available plugins, the repo-server will list 
the shared plugins directory to discover the available plugins.</p>
<p>To communicate with a plugin, the repo-server will simply need to connect to the socket and make gRPC calls against the 
cmp-server listening on the other side. </p>
<h4 id="discovery-auto-selection-of-tool">Discovery (Auto-selection of Tool)<a class="headerlink" href="#discovery-auto-selection-of-tool" title="Permanent link">&para;</a></h4>
<ul>
<li>The plugin discovery will run in the main repo-server container.</li>
<li>Argo CD repo-server lists the shared plugins directory and runs <code>discover</code> command from the specification file, 
whichever plugin provides a positive response first will be selected.</li>
</ul>
<h4 id="versioning">Versioning<a class="headerlink" href="#versioning" title="Permanent link">&para;</a></h4>
<p>There will be one sidecar container per version. Hence, for two different versions users will have to configure two different sidecars.</p>
<h3 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h3>
<p>The use of the plugin as sidecars separate from the repo-server is already a security improvement over the current v1.8 
config management plugin mechanism, since the plugin tooling will no longer have access to the files of the argocd-repo-server image. 
However additional improvements can be made to increase security.</p>
<h3 id="risks-and-mitigations">Risks and Mitigations<a class="headerlink" href="#risks-and-mitigations" title="Permanent link">&para;</a></h3>
<p>One issue is that currently when repositories are cloned, the repo is cloned using the same UID of the repo-server user, 
and so all repository files are created using that UID. This means that a command which executes in the git repository path, 
could traverse upwards and see/write files which are outside of the repository tree.</p>
<p>One proposal to prevent out-of-tree access to files, is that each git repository could be cloned with unique UIDs, 
different from the repo-server’s UID. When the cmp-server executes the tooling command to generate manifests, 
the command could be executed using the UID of the git repository files. e.g.:</p>
<div class="codehilite"><pre><span></span><code><span class="err">cmd := exec.Command(command, args...)</span>
<span class="err">cmd.SysProcAttr = &amp;syscall.SysProcAttr{}</span>
<span class="err">cmd.SysProcAttr.Credential = &amp;syscall.Credential{Uid: uid, Gid: gid}</span>
</code></pre></div>

<p>This would ensure that the command could not read or write anything out-of-tree from the repository directory.</p>
<h3 id="upgrade-downgrade-strategy">Upgrade / Downgrade Strategy<a class="headerlink" href="#upgrade-downgrade-strategy" title="Permanent link">&para;</a></h3>
<p>The argocd-repo-server manifest will change in order to populate the argocd-cmp-server binary inside the plugin container 
via an init container.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># An init container will copy the argocd static binary into the shared volume</span>
<span class="c1"># so that the CMP server can become the entrypoint</span>
initContainers:
- command:
  - cp
  - -n
  - /usr/local/bin/argocd
  - /var/run/argocd/argocd-cmp-server
  image: quay.io/argoproj/argocd:latest
  name: copyutil
  volumeMounts:
  - mountPath: /var/run/argocd
    name: var-files

<span class="c1"># var-files is a shared volume between repo-server and cmp-server which holds:</span>
<span class="c1"># 1) socket files that repo-server uses to communicate to each plugin</span>
<span class="c1"># 2) git repositories cloned by repo-server</span>
volumes:
- emptyDir: <span class="o">{}</span>
  name: var-files
</code></pre></div>

<p>After upgrading to CMP v2, an Argo CD operator will have to make following changes,</p>
<ul>
<li>In order to install a plugin, an Argo CD operator will simply have to patch argocd-repo-server 
to run config management plugin container as a sidecar, with argocd-cmp-server as it’s entrypoint:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1"># A plugin is a container image which runs as a sidecar, with the execution environment</span>
<span class="c1"># necessary to render manifests. To install a plugin, </span>
containers:
- name: cdk8s
  command: <span class="o">[</span>/var/run/argocd/argocd-cmp-server<span class="o">]</span>
  image: docker.ui/cdk8s/cdk8s:latest
  volumeMounts:
  - mountPath: /var/run/argocd
    name: var-files
</code></pre></div>

<ul>
<li>Plugins will be configured via a ConfigManagementPlugin manifest located inside the plugin container, placed at a 
well-known location (e.g. /plugin.yaml). Argo CD is agnostic to the mechanism of how the plugin.yaml would be placed, 
but various options can be used on how to place this file, including: <ul>
<li>Baking the file into the plugin image as part of docker build</li>
<li>Volume mapping the file through a configmap.
(For more details please refer to <a href="#configuration">implementation details</a>)</li>
</ul>
</li>
</ul>
<h2 id="drawbacks">Drawbacks<a class="headerlink" href="#drawbacks" title="Permanent link">&para;</a></h2>
<p>There aren't any major drawbacks to this proposal. Also, the advantages supersede the minor learning curve of the new way of managing plugins.</p>
<p>However following are few minor drawbacks,</p>
<ul>
<li>With addition of plugin.yaml, there will be more yamls to manage</li>
<li>Operators need to be aware of the modified kubernetes manifests in the subsequent version.</li>
<li>The format of the CMP manifest is a new "contract" that would need to adhere the usual Argo CD compatibility promises in future.</li>
</ul>
<h2 id="alternatives">Alternatives<a class="headerlink" href="#alternatives" title="Permanent link">&para;</a></h2>
<ol>
<li>ConfigManagementPlugin as CRD. Have a CR which the human operator creates:</li>
</ol>
<div class="codehilite"><pre><span></span><code>apiVersion: argoproj.io/v1alpha1
kind: ConfigManagementPlugin
metadata:
  name: cdk8s
spec:
  name: cdk8s
  image: docker.ui/cdk8s/cdk8s:latest
  version: v1.0
  init:
    command: <span class="o">[</span>cdk8s, init<span class="o">]</span>
  generate:
    command: <span class="o">[</span>sh, -c, <span class="s2">&quot;cdk8s synth &amp;&amp; cat dist/*.yaml&quot;</span><span class="o">]</span>
  discovery:
    find:
    - command: <span class="o">[</span>find . -name main.ts<span class="o">]</span>
      glob: <span class="s2">&quot;**/*/main.ts&quot;</span>
    check:
    - command: <span class="o">[</span>-f ./main.ts<span class="o">]</span>
      glob: <span class="s2">&quot;main.ts&quot;</span>
  allowConcurrency: <span class="nb">true</span> <span class="c1"># enables generating multiple manifests in parallel. </span>
</code></pre></div>

<ol>
<li>Something magically patches the relevant manifest to add the sidecar.</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.76f349be.min.js"></script>
      
        <script src="../../assets/versions.js"></script>
      
    
  </body>
</html>